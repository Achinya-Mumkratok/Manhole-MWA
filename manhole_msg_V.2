{{ define "manhole_msg_V.2" }} 
  {{ $latest_alert := "" }} 
  {{ $latest_timestamp := "" }} 
  {{ $latest_alertname := "" }} 
  {{ $latest_device := "" }} 

  {{ $prev_alertname := "" }}
  {{ $prev_device := "" }}
  {{ $prev_timestamp := "" }}

  {{ range .Alerts.Firing }} 
    {{ if or (eq $latest_timestamp "" ) (gt .Labels.Timestamp $latest_timestamp) }}
      {{ if or (ne .Labels.alertname $prev_alertname) (ne .Labels.Device $prev_device) (ne .Labels.Timestamp $prev_timestamp) }}
        {{ $latest_alert = . }} 
        {{ $latest_timestamp = .Labels.Timestamp }} 
        {{ $latest_alertname = .Labels.alertname }} 
        {{ $latest_device = .Labels.Device }} 

        {{ $prev_alertname = .Labels.alertname }}
        {{ $prev_device = .Labels.Device }}
        {{ $prev_timestamp = .Labels.Timestamp }}
      {{ end }}
    {{ end }} 
  {{ end }} 
  {{ if $latest_alert }}
    {{ if eq $latest_alert.Labels.alertname "Manhole_Level_Alert" }}
    üö® ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô !
    ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö!

    ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: {{ $latest_alert.Labels.Device }}
    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: {{ $latest_alert.Labels.Location }}
    ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥: {{ $latest_alert.Labels.Level }}
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏≤‡∏ó‡πà‡∏≠: {{ $latest_alert.Labels.Cover_Status }}
    ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà: {{ $latest_alert.Labels.Battery_Percentage }}

    Timestamp: {{ $latest_alert.Labels.Timestamp }}
    {{ else if eq $latest_alert.Labels.alertname "Manhole_Cover_Alert" }}
    üö® ‡∏ù‡∏≤‡∏ó‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î !
    ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö!

    ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: {{ $latest_alert.Labels.Device }}
    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: {{ $latest_alert.Labels.Location }}
    ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥: {{ $latest_alert.Labels.Level }}
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏≤‡∏ó‡πà‡∏≠: {{ $latest_alert.Labels.Cover_Status }}
    ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà: {{ $latest_alert.Labels.Battery_Percentage }}

    Timestamp: {{ $latest_alert.Labels.Timestamp }}
    {{ else if eq $latest_alert.Labels.alertname "Manhole_Battery_Alert" }}
    üö® Battery Low <30% !
    ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö!

    ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: {{ $latest_alert.Labels.Device }}
    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: {{ $latest_alert.Labels.Location }}
    ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥: {{ $latest_alert.Labels.Level }}
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏≤‡∏ó‡πà‡∏≠: {{ $latest_alert.Labels.Cover_Status }}
    ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà: {{ $latest_alert.Labels.Battery_Percentage }} %

    Timestamp: {{ $latest_alert.Labels.Timestamp }}
    {{ else if eq $latest_alert.Labels.alertname "Manhole_Level_Status_Change" }}
    ‚ö†Ô∏è ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö
    ({{ $latest_alert.Labels.Previous_Level }} >>> {{ $latest_alert.Labels.Current_Level }})

    ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: {{ $latest_alert.Labels.Device }}
    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: {{ $latest_alert.Labels.Location }}
    ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥: {{ $latest_alert.Labels.Level }}
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏≤‡∏ó‡πà‡∏≠: {{ $latest_alert.Labels.Cover_Status }}
    ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà: {{ $latest_alert.Labels.Battery_Percentage }}

    Timestamp: {{ $latest_alert.Labels.Timestamp }}
    {{ else if eq $latest_alert.Labels.alertname "Manhole_Level_Resolve" }}
    üü¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏õ‡∏Å‡∏ï‡∏¥
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß

    ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: {{ $latest_alert.Labels.Device }}
    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: {{ $latest_alert.Labels.Location }}
    ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥: {{ $latest_alert.Labels.Level }}
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏≤‡∏ó‡πà‡∏≠: {{ $latest_alert.Labels.Cover_Status }}
    ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà: {{ $latest_alert.Labels.Battery_Percentage }}

    Timestamp: {{ $latest_alert.Labels.Timestamp }}
    {{ else if eq $latest_alert.Labels.alertname "Manhole_Cover_Resolve" }}
    üü¢‡∏ù‡∏≤‡∏ó‡πà‡∏≠‡∏õ‡∏¥‡∏î
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß

    ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: {{ $latest_alert.Labels.Device }}
    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: {{ $latest_alert.Labels.Location }}
    ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥: {{ $latest_alert.Labels.Level }}
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏≤‡∏ó‡πà‡∏≠: {{ $latest_alert.Labels.Cover_Status }}
    ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà: {{ $latest_alert.Labels.Battery_Percentage }}

    Timestamp: {{ $latest_alert.Labels.Timestamp }}
    {{ else if eq $latest_alert.Labels.alertname "Manhole_Battery_Resolve" }}
    üü¢Battery High
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß

    ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: {{ $latest_alert.Labels.Device }}
    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: {{ $latest_alert.Labels.Location }}
    ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥: {{ $latest_alert.Labels.Level }}
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏≤‡∏ó‡πà‡∏≠: {{ $latest_alert.Labels.Cover_Status }}
    ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà: {{ $latest_alert.Labels.Battery_Percentage }}

    Timestamp: {{ $latest_alert.Labels.Timestamp }}
    {{ end }}
  {{ end }}
{{ end }}
